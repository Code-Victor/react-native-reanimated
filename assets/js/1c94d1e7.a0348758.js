"use strict";(self.webpackChunkreact_native_reanimated_docs=self.webpackChunkreact_native_reanimated_docs||[]).push([[5793],{19310:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>H,contentTitle:()=>X,default:()=>q,frontMatter:()=>R,metadata:()=>V,toc:()=>M});var a=n(83117),l=n(67294),r=n(3905),o=n(67177),i=n(72862),s=n(10758),c=n(17020),u=n(35842),m=n(49638);const d={code:"function anonymous(frameInfo){const{t}=this.__closure;t.value=frameInfo.timeSinceFirstFrame/350;}"},h={code:"function anonymous(){const{t}=this.__closure;const scale=2/(3-Math.cos(2*t.value))*200;return{transform:[{translateX:scale*Math.cos(t.value)},{translateY:scale*(Math.sin(2*t.value)/2)}]};}"};function v(){const e=(0,s.y)(0);(0,c.N)(function(){const t=function(t){e.value=t.timeSinceFirstFrame/350};return t.__closure={t:e},t.__initData=d,t.__workletHash=0xda127f42ef9,t}());const t=(0,u.l)(function(){const t=function(){const t=2/(3-Math.cos(2*e.value))*200;return{transform:[{translateX:t*Math.cos(e.value)},{translateY:t*(Math.sin(2*e.value)/2)}]}};return t.__closure={t:e},t.__initData=h,t.__workletHash=7324566857812,t}());return l.createElement(o.Z,{style:b.container},l.createElement(m.n,{style:[b.dot,t]}))}const b=i.Z.create({container:{flex:1,alignItems:"center",justifyContent:"center",height:150},dot:{width:60,height:60,borderRadius:30,backgroundColor:"#b58df1",position:"absolute"}}),f="import React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport Animated, {\n  useFrameCallback,\n  useSharedValue,\n  useAnimatedStyle,\n} from 'react-native-reanimated';\n\nexport default function App() {\n  const t = useSharedValue(0);\n\n  // highlight-start\n  useFrameCallback((frameInfo) => {\n    t.value = frameInfo.timeSinceFirstFrame / 350;\n  });\n  // highlight-end\n\n  const infinityStyle = useAnimatedStyle(() => {\n    const scale = (2 / (3 - Math.cos(2 * t.value))) * 200;\n    return {\n      transform: [\n        { translateX: scale * Math.cos(t.value) },\n        { translateY: scale * (Math.sin(2 * t.value) / 2) },\n      ],\n    };\n  });\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.dot, infinityStyle]} />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: 150,\n  },\n  dot: {\n    width: 60,\n    height: 60,\n    borderRadius: 30,\n    backgroundColor: '#b58df1',\n    position: 'absolute',\n  },\n});\n";var p=n(12448),k=n(6328),y=n(87827),g=n(68171),_=n(70399),E=n(24404);const C=.6,T=5e-5,F=40,A=1e3,S={height:85,width:82,x:0,y:F},x={height:85,width:82,x:0,y:F},w={code:"function anonymous(frameInfo){const{DEFAULT_HORSE,horseY,DEFAULT_OBSTACLE,obstacleX,isColliding,gameOver,vx,width,VELOCITY_INCREMENT}=this.__closure;const{timeSincePreviousFrame:dt}=frameInfo;if(dt==null){return;}const horse={...DEFAULT_HORSE,y:horseY.value};const obstacle={...DEFAULT_OBSTACLE,x:obstacleX.value};if(isColliding(horse,obstacle)||gameOver.value){gameOver.value=true;return;}obstacleX.value=obstacleX.value>-100?obstacleX.value-vx.value*dt:width.value;vx.value+=VELOCITY_INCREMENT;}"},L={code:"function anonymous(){const{obstacleX,DEFAULT_OBSTACLE}=this.__closure;return{transform:[{translateX:obstacleX.value},{translateY:DEFAULT_OBSTACLE.y}]};}"},N={code:"function anonymous(){const{DEFAULT_HORSE,horseY}=this.__closure;return{transform:[{translateX:DEFAULT_HORSE.x},{translateY:horseY.value},{rotateY:'180deg'}]};}"},D={code:"function anonymous(){const{gameOver}=this.__closure;return{transform:[{translateY:gameOver.value===true?0:-1000}]};}"};function O(){const e=(0,s.y)(C),t=(0,s.y)(0),n=(0,s.y)(A),a=(0,s.y)(F),r=(0,s.y)(!1);(0,c.N)(function(){const l=function(l){const{timeSincePreviousFrame:o}=l;if(null==o)return;const i={...x,y:a.value},s={...S,x:n.value};j(i,s)||r.value?r.value=!0:(n.value=n.value>-100?n.value-e.value*o:t.value,e.value+=T)};return l.__closure={DEFAULT_HORSE:x,horseY:a,DEFAULT_OBSTACLE:S,obstacleX:n,isColliding:j,gameOver:r,vx:e,width:t,VELOCITY_INCREMENT:T},l.__initData=w,l.__workletHash=1605437373042,l}());const i=(0,u.l)(function(){const e=()=>({transform:[{translateX:n.value},{translateY:S.y}]});return e.__closure={obstacleX:n,DEFAULT_OBSTACLE:S},e.__initData=L,e.__workletHash=9093535215385,e}()),d=(0,u.l)(function(){const e=()=>({transform:[{translateX:x.x},{translateY:a.value},{rotateY:"180deg"}]});return e.__closure={DEFAULT_HORSE:x,horseY:a},e.__initData=N,e.__workletHash=3538270412631,e}()),h=(0,u.l)(function(){const e=()=>({transform:[{translateY:!0===r.value?0:-1e3}]});return e.__closure={gameOver:r},e.__initData=D,e.__workletHash=5862240301278,e}()),v=()=>{a.value===F&&(a.value=(0,p.u)((0,k.j)(F-120,{easing:y.o.bezier(.3,.11,.15,.97)}),(0,k.j)(F,{easing:y.o.poly(4)})))},b=()=>{r.value=!1,n.value=A,a.value=F,e.value=C};return l.createElement(l.Fragment,null,l.createElement(_.Z,{style:I.container,onLayout:e=>{t.value=e.nativeEvent.layout.width},onPressIn:()=>{r.value?b():v()}},l.createElement(m.n,{style:[I.overlay,h]},l.createElement(E.Z,{style:I.text},"Game Over")),l.createElement(g.V,{style:[I.obstacle,i]},"\ud83c\udf35"),l.createElement(g.V,{style:[I.horse,d]},"\ud83d\udc0e"),l.createElement(o.Z,{style:I.ground})))}const I=i.Z.create({container:{flex:1,height:200},horse:{position:"absolute",fontSize:80},ground:{position:"absolute",right:0,bottom:70,width:"100%",height:2,backgroundColor:"#000"},obstacle:{position:"absolute",fontSize:80},text:{fontSize:40,color:"white",backgroundColor:"rgba(0,0,0,0.5)",paddingHorizontal:8},overlay:{justifyContent:"center",alignItems:"center",position:"absolute",width:"100%",zIndex:1}}),Y={code:"function isColliding(obj1,obj2){return obj1.x<obj2.x+obj2.width&&obj1.x+obj1.width>obj2.x&&obj1.y<obj2.y+obj2.height&&obj1.y+obj1.height>obj2.y;}"},j=function(){const e=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y};return e.__closure={},e.__initData=Y,e.__workletHash=3023621340167,e}(),U="import Animated, {\n  useSharedValue,\n  useFrameCallback,\n  useAnimatedStyle,\n  withSequence,\n  withTiming,\n  Easing,\n} from 'react-native-reanimated';\nimport { View, StyleSheet, Pressable, Text } from 'react-native';\nimport React from 'react';\n\nconst HEIGHT = 200;\nconst DEFAULT_VELOCITY = 0.6;\nconst VELOCITY_INCREMENT = 0.00005;\nconst GROUND_LEVEL = 80;\nconst DEFAULT_Y = HEIGHT - GROUND_LEVEL - 80;\nconst DEFAULT_X = 1000;\n\nconst DEFAULT_OBSTACLE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\nconst DEFAULT_HORSE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\n\nexport default function FrameCallbackDino() {\n  const vx = useSharedValue(DEFAULT_VELOCITY);\n  const width = useSharedValue(0);\n\n  const obstacleX = useSharedValue(DEFAULT_X);\n  const horseY = useSharedValue(DEFAULT_Y);\n\n  const gameOver = useSharedValue(false);\n\n  const getDimensions = (event) => {\n    width.value = event.nativeEvent.layout.width;\n  };\n\n  // highlight-next-line\n  useFrameCallback((frameInfo) => {\n    const { timeSincePreviousFrame: dt } = frameInfo;\n    if (dt == null) {\n      return;\n    }\n\n    const horse = { ...DEFAULT_HORSE, y: horseY.value };\n    const obstacle = { ...DEFAULT_OBSTACLE, x: obstacleX.value };\n\n    if (isColliding(horse, obstacle) || gameOver.value) {\n      gameOver.value = true;\n      return;\n    }\n\n    obstacleX.value =\n      obstacleX.value > -100 ? obstacleX.value - vx.value * dt : width.value;\n\n    vx.value += VELOCITY_INCREMENT;\n    // highlight-next-line\n  });\n\n  const obstacleStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: obstacleX.value },\n      { translateY: DEFAULT_OBSTACLE.y },\n    ],\n  }));\n\n  const horseStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: DEFAULT_HORSE.x },\n      { translateY: horseY.value },\n      { rotateY: '180deg' },\n    ],\n  }));\n\n  const overlayStyles = useAnimatedStyle(() => ({\n    transform: [{ translateY: gameOver.value === true ? 0 : -1000 }],\n  }));\n\n  const handleTap = () => {\n    if (gameOver.value) {\n      handleRestart();\n    } else {\n      handleJump();\n    }\n  };\n\n  const handleJump = () => {\n    if (horseY.value === DEFAULT_Y) {\n      horseY.value = withSequence(\n        withTiming(DEFAULT_Y - 120, {\n          easing: Easing.bezier(0.3, 0.11, 0.15, 0.97),\n        }),\n        withTiming(DEFAULT_Y, { easing: Easing.poly(4) })\n      );\n    }\n  };\n\n  const handleRestart = () => {\n    gameOver.value = false;\n    obstacleX.value = DEFAULT_X;\n    horseY.value = DEFAULT_Y;\n    vx.value = DEFAULT_VELOCITY;\n  };\n\n  return (\n    <>\n      <Pressable\n        style={styles.container}\n        onLayout={getDimensions}\n        onPressIn={handleTap}>\n        <Animated.View style={[styles.overlay, overlayStyles]}>\n          <Text style={styles.text}>Game Over</Text>\n        </Animated.View>\n        <Animated.Text style={[styles.obstacle, obstacleStyles]}>\n          \ud83c\udf35\n        </Animated.Text>\n        <Animated.Text style={[styles.horse, horseStyles]}>\ud83d\udc0e</Animated.Text>\n        <View style={styles.ground} />\n      </Pressable>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    height: 200,\n  },\n  horse: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  ground: {\n    position: 'absolute',\n    right: 0,\n    bottom: GROUND_LEVEL - 10,\n    width: '100%',\n    height: 2,\n    backgroundColor: '#000',\n  },\n  obstacle: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  text: {\n    fontSize: 40,\n    color: 'white',\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    paddingHorizontal: 8,\n  },\n  overlay: {\n    justifyContent: 'center',\n    alignItems: 'center',\n    position: 'absolute',\n    width: '100%',\n    zIndex: 1,\n  },\n});\n\nfunction isColliding(obj1, obj2) {\n  'worklet';\n  return (\n    obj1.x < obj2.x + obj2.width &&\n    obj1.x + obj1.width > obj2.x &&\n    obj1.y < obj2.y + obj2.height &&\n    obj1.y + obj1.height > obj2.y\n  );\n}\n",R={sidebar_position:3},X="useFrameCallback",V={unversionedId:"advanced/useFrameCallback",id:"advanced/useFrameCallback",title:"useFrameCallback",description:"useFrameCallback lets you run a function on every frame update.",source:"@site/docs/advanced/useFrameCallback.mdx",sourceDirName:"advanced",slug:"/advanced/useFrameCallback",permalink:"/react-native-reanimated/docs/advanced/useFrameCallback",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/tree/main/docs/docs/advanced/useFrameCallback.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"useAnimatedReaction",permalink:"/react-native-reanimated/docs/advanced/useAnimatedReaction"},next:{title:"useEvent",permalink:"/react-native-reanimated/docs/advanced/useEvent"}},H={},M=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>callback</code>",id:"callback",level:4},{value:"<code>autostart</code> <Optional />",id:"autostart-",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],z=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},P=z("InteractiveExample"),B=z("Optional"),G={toc:M},Z="wrapper";function q(e){let{components:t,...n}=e;return(0,r.kt)(Z,(0,a.Z)({},G,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"useframecallback"},"useFrameCallback"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useFrameCallback")," lets you run a function on every frame update."),(0,r.kt)(P,{src:f,component:(0,r.kt)(v,{mdxType:"FrameCallbackSimple"}),mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { useFrameCallback } from 'react-native-reanimated';\n\nfunction App() {\n  const frameCallback = useFrameCallback((frameInfo) => {\n    // Increment a value on every frame update\n    sv.value += 1;\n  });\n\n  return (\n    <Button\n      title=\"Start/Stop\"\n      onPress={() => frameCallback.setActive(!frameCallback.isActive)}\n    />\n  );\n}\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Type definitions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"type FrameInfo = {\n  timestamp: number;\n  timeSincePreviousFrame: number | null;\n  timeSinceFirstFrame: number;\n};\n\ntype FrameCallback = {\n  setActive: (isActive: boolean) => void;\n  isActive: boolean;\n  callbackId: number;\n};\n\nfunction useFrameCallback(\n  callback: (frameInfo: FrameInfo) => void,\n  autostart = true\n): FrameCallback;\n"))),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("h4",{id:"callback"},(0,r.kt)("inlineCode",{parentName:"h4"},"callback")),(0,r.kt)("p",null,"A function executed on every frame update. This function receives a ",(0,r.kt)("inlineCode",{parentName:"p"},"frameInfo")," object containing the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp")," a number indicating the system time (in milliseconds) when the last frame was rendered."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timeSincePreviousFrame")," a number indicating the time (in milliseconds) since last frame. This value will be null on the first frame after activation. Starting from the second frame, it should be ~16 ms on 60 Hz, and ~8 ms on 120 Hz displays (provided there are no frame dropped)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timeSinceFirstFrame")," a number indicating the time (in milliseconds) since the callback was activated.")),(0,r.kt)("h4",{id:"autostart-"},(0,r.kt)("inlineCode",{parentName:"h4"},"autostart")," ",(0,r.kt)(B,{mdxType:"Optional"})),(0,r.kt)("p",null,"Whether the callback should start automatically. Defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("h3",{id:"returns"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useFrameCallback")," returns an object containing these fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setActive")," a function that lets you start the frame callback or stop it from running"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"isActive")," a boolean indicating whether a callback is running"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"callbackId")," a number indicating a unique identifier of the frame callback")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)(P,{src:U,component:(0,r.kt)(O,{mdxType:"FrameCallbackDino"}),label:"Tap to jump",mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"remarks"},"Remarks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A function passed to the ",(0,r.kt)("inlineCode",{parentName:"li"},"callback")," argument is automatically ",(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#to-workletize"},"workletized")," and ran on the ",(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),".")),(0,r.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.kt)("div",{className:"platform-compatibility"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Android"),(0,r.kt)("th",{parentName:"tr",align:null},"iOS"),(0,r.kt)("th",{parentName:"tr",align:null},"Web"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"))))))}q.isMDXComponent=!0}}]);